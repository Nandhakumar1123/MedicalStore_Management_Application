<!DOCTYPE html>
<html>
<head>
    <title>Reports</title>
    <style>
        body { font-family: Arial, sans-serif; background: #f4f6f9; margin: 0; padding: 0; }
        header { background: linear-gradient(90deg, #0066cc, #004080); padding: 15px; text-align: center; box-shadow: 0 2px 5px rgba(0,0,0,0.2); position: sticky; top: 0; z-index: 1000; }
        header a { color: white; margin: 0 20px; text-decoration: none; font-weight: bold; font-size: 16px; transition: 0.3s; }
        header a:hover { color: #ffcc00; }
        .subnav { background: #0059b3; padding: 10px; text-align: center; }
        .subnav a { color: white; margin: 0 15px; text-decoration: none; font-weight: bold; font-size: 15px; transition: 0.3s; }
        .subnav a:hover { color: #ffcc00; }
        .report { padding: 25px; background: white; border-radius: 12px; max-width: 800px; margin: 30px auto; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
        h2, h3 { color: #004080; text-align: center; }
        p { font-size: 17px; margin: 8px 0; }
        table { margin: 20px auto; border-collapse: collapse; width: 100%; background: white; border-radius: 10px; overflow: hidden; }
        th, td { padding: 12px 15px; border: 1px solid #ddd; text-align: center; }
        th { background-color: #0066cc; color: white; font-size: 15px; }
        tr:nth-child(even) { background-color: #f2f6fc; }
        tr:hover { background-color: #e6f0ff; }
        footer { text-align: center; background: linear-gradient(90deg, #0066cc, #004080); color: white; padding: 15px; position: fixed; bottom: 0; width: 100%; font-size: 14px; }
        .chart-container { margin-top: 30px; }
    </style>
</head>
<body>
    <header>
        <a href="/dashboard">Dashboard</a>
        <a href="/medicines">Medicines</a>
        <a href="/add_medicine">Add Medicines</a>
        <a href="/billing">Billing</a>
        <a href="/report">Reports</a>
    </header>
    <div class="subnav">
        <a href="/medicine_arrivals">Arrival</a>
        <a href="/billing_history">Billing History</a>
    </div>

    <div class="report">
        <h2>Medicine Report</h2>
        <p><b>Total Medicines:</b> {{ medicines | length }}</p>
        <p><b>Total Quantity in Stock:</b> {{ total_qty }}</p>
        <p><b>Total Arrived:</b> {{ total_arrived }}</p>
        <p><b>Total Sold:</b> {{ total_sold }}</p>
        <p><b>Total Amount Earned:</b> Rs. {{ '%.2f' | format(total_amount) }}</p>
    </div>

    <div class="report">
        <h3>Daily Report</h3>
        <table>
            <thead>
                <tr>
                    <th>Date</th>
                    <th>Arrived</th>
                    <th>Sold</th>
                    <th>Amount Earned (Rs.)</th>
                </tr>
            </thead>
            <tbody>
                {% for day in daily_report %}
                <tr>
                    <td>{{ day.date }}</td>
                    <td>{{ day.arrived }}</td>
                    <td>{{ day.sold }}</td>
                    <td>Rs. {{ '%.2f' | format(day.earned) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- Sales Analytics -->
    <div class="report chart-container">
        <h3>ðŸ“Š Sales Analytics</h3>
        <canvas id="salesChart" width="400" height="200"></canvas>
    </div>

    <footer>&copy; 2025 Medical Store | Nandhakumar</footer>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
    fetch("/analytics/sales")
      .then(res => res.json())
      .then(data => {
        const labels = data.sales_trends.map(r => r.date);
        const revenue = data.sales_trends.map(r => r.revenue);
        new Chart(document.getElementById("salesChart"), {
          type: "line",
          data: { labels, datasets: [{ label: "Revenue (â‚¹)", data: revenue, borderColor: "blue", fill: false }] }
        });
      });
    </script>
</body>
</html>
